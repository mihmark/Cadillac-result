<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadillac F1 Team – Eredmények</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
      text-align: center;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #222;
    }
    .gold { background-color: gold; color: black; font-weight: bold; }
    .silver { background-color: silver; color: black; font-weight: bold; }
    .bronze { background-color: #cd7f32; color: black; font-weight: bold; }
    .dnf { background-color: red; color: white; font-weight: bold; }
    .disabled { background-color: #333; color: #777; pointer-events: none; }
    button {
      background-color: black;
      color: white;
      border: 2px solid gold;
      padding: 8px 16px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s, transform 0.2s;
    }
    button:hover {
      background-color: gold;
      color: black;
      transform: scale(1.05);
    }
    .login-btn {
      background-color: gold;
      color: black;
      font-weight: bold;
    }
    .login-btn:hover {
      background-color: #d4af37;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <h1 id="title">Cadillac F1 Team – 1. Szezon</h1>
  <div>
    <button onclick="switchSeason(1)">1. Szezon</button>
    <button onclick="switchSeason(2)">2. Szezon</button>
  </div>
  <p id="login-status"></p>
  <div id="main-container" style="display: none;">
    <table id="results-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Név</th>
          <th>Helyszín</th>
          <th>Sprint</th>
          <th>Sprint Q</th>
          <th>Q</th>
          <th>Futam</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBtWYLAHfvJvkFKHb9JvErm-2G5Mei_l64",
      authDomain: "eredmenyek-5ebb7.firebaseapp.com",
      projectId: "eredmenyek-5ebb7",
      storageBucket: "eredmenyek-5ebb7.appspot.com",
      messagingSenderId: "954248784188",
      appId: "1:954248784188:web:4d4e90b1dc70f0aeaa1639"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const allowedEmails = [
      "mmark1209@outlook.com",
      "masik@email.hu"
    ];

    let isEditor = false;

    auth.getRedirectResult().then(result => {
      if (result.user) {
        console.log("Visszatért Google belépés után:", result.user.email);
      }
    }).catch(error => {
      console.error("Redirect hiba:", error.message);
    });

    auth.onAuthStateChanged(user => {
      const status = document.getElementById("login-status");
      if (user) {
        if (allowedEmails.includes(user.email)) {
          status.innerText = `Bejelentkezve: ${user.email}`;
          isEditor = true;
        } else {
          status.innerText = `Bejelentkezve: ${user.email} (nincs jogosultság szerkeszteni)`;
          isEditor = false;
        }
      } else {
        status.innerHTML = `<button class="login-btn" onclick="login()">Bejelentkezés Google-fiókkal</button>`;
        isEditor = false;
      }
      document.getElementById("main-container").style.display = "block";
      buildTable();
    });

    function login() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithRedirect(provider);
    }

    const races = [
      ["Ausztrál", "Melbourne", false],
      ["Kínai", "Sanghaj", true],
      ["Japán", "Szuzuka", false],
      ["Bahreini", "Szahír", false],
      ["Szaúd-arábiai", "Dzsidda", false],
      ["Miami", "Miami", true],
      ["Emilia-Romagna", "Imola", false],
      ["Monacói", "Monaco", false],
      ["Spanyol", "Barcelona", false],
      ["Kanadai", "Montreal", false],
      ["Osztrák", "Spielberg", false],
      ["Brit", "Silverstone", false],
      ["Belga", "Spa-Francorchamps", true],
      ["Magyar", "Mogyoród", false],
      ["Holland", "Zandvoort", false],
      ["Olasz", "Monza", false],
      ["Azerbajdzsáni", "Baku", false],
      ["Szingapúri", "Szingapúr", false],
      ["USA", "Austin", true],
      ["Mexikói", "Mexikóváros", false],
      ["São Paulo-i", "São Paulo", true],
      ["Las Vegas-i", "Las Vegas", false],
      ["Qatar-i", "Lasoil", false],
      ["Abu Dzabi", "Abu Dzabi", false]
    ];

    let currentSeason = 1;
    let unsubscribeFns = [];

    function switchSeason(season) {
      currentSeason = season;
      document.getElementById("title").innerText = `Cadillac F1 Team – ${season}. Szezon`;
      unsubscribeFns.forEach(unsub => unsub());
      unsubscribeFns = [];
      buildTable();
    }

    function applyStyle(cell) {
      const value = cell.innerText.trim().toUpperCase();
      cell.classList.remove("gold", "silver", "bronze", "dnf");
      if (value === "1") cell.classList.add("gold");
      else if (value === "2") cell.classList.add("silver");
      else if (value === "3") cell.classList.add("bronze");
      else if (value === "DNF") cell.classList.add("dnf");
    }

    function buildTable() {
      const tableBody = document.querySelector("#results-table tbody");
      tableBody.innerHTML = "";
      const collection = currentSeason === 1 ? "results" : "results_s2";

      races.forEach((race, index) => {
        const [name, location, hasSprint] = race;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${name}</td>
          <td>${location}</td>
          <td ${hasSprint ? 'contenteditable="true"' : 'class="disabled"'} id="cell-${index}-sprint"></td>
          <td ${hasSprint ? 'contenteditable="true"' : 'class="disabled"'} id="cell-${index}-sprintqual"></td>
          <td contenteditable="true" id="cell-${index}-qual"></td>
          <td contenteditable="true" id="cell-${index}-race"></td>
        `;
        tableBody.appendChild(tr);

        ["sprint", "sprintqual", "qual", "race"].forEach(type => {
          const cellId = `cell-${index}-${type}`;
          const cell = document.getElementById(cellId);
          if (!cell || cell.classList.contains("disabled")) return;

          if (!isEditor) {
            cell.contentEditable = "false";
            return;
          }

          cell.addEventListener("input", () => {
            const value = cell.innerText.trim();
            db.collection(collection).doc(cellId).set({ value });
          });

          const unsub = db.collection(collection).doc(cellId).onSnapshot(doc => {
            if (doc.exists) {
              const value = doc.data().value || "";
              if (cell.innerText.trim() !== value) {
                cell.innerText = value;
                applyStyle(cell);
              }
            }
          });
          unsubscribeFns.push(unsub);
        });
      });
    }
  </script>
</body>
</html>

